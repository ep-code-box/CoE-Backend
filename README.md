# π¤– λ¨λ“ν• LangGraph μ—μ΄μ „νΈ ν”„λ μ„μ›ν¬

μ΄ ν”„λ΅μ νΈλ” **LangGraph**μ™€ **FastAPI**λ¥Ό κΈ°λ°μΌλ΅ κµ¬μ¶•λ, ν™•μ¥μ„±μ΄ λ§¤μ° λ›°μ–΄λ‚ λ¨λ“ν• AI μ—μ΄μ „νΈ ν”„λ μ„μ›ν¬μ…λ‹λ‹¤. **λ„κµ¬ λ μ§€μ¤νΈλ¦¬(Tool Registry)** ν¨ν„΄μ„ λ„μ…ν•μ—¬, μƒλ΅μ΄ κΈ°λ¥μ„ μ¶”κ°€ν•  λ• λ©”μΈ μ• ν”λ¦¬μΌ€μ΄μ… μ½”λ“λ¥Ό μ „ν€ μμ •ν•  ν•„μ”κ°€ μ—†λ” κµ¬μ΅°λ¥Ό κ°–μ¶”κ³  μμµλ‹λ‹¤.

## β¨ μ£Όμ” κΈ°λ¥ (Features)

- **λ™μ  λ„κµ¬ λΌμ°ν…**: LLMμ„ μ‚¬μ©ν•μ—¬ μ‚¬μ©μμ μ”μ²­μ— κ°€μ¥ μ ν•©ν• λ„κµ¬λ¥Ό λ™μ μΌλ΅ μ„ νƒν•©λ‹λ‹¤.
- **μ™„λ²½ν• λ¨λ“ν™” λ° ν™•μ¥μ„±**: κ° λ„κµ¬μ κΈ°λ¥, μ„¤λ…, κ·Έλν”„ μ—°κ²°(νλ¦„) λ΅μ§μ΄ κ°λ³„ νμΌλ΅ λ¶„λ¦¬λμ–΄ λ…λ¦½μ μΌλ΅ κ΄€λ¦¬λ©λ‹λ‹¤.
- **μλ™ λ„κµ¬ λ“±λ΅ (Tool Registry)**: `tools` λ””λ ‰ν„°λ¦¬μ— μƒλ΅μ΄ λ„κµ¬ νμΌμ„ μ¶”κ°€ν•λ” κ²ƒλ§μΌλ΅ μ—μ΄μ „νΈμ— μλ™μΌλ΅ ν†µν•©λ©λ‹λ‹¤.
- **λ‹¤μ–‘ν• λ„κµ¬ ν†µν•© μμ‹**:
    - κ°„λ‹¨ν• Python ν•¨μ (ν…μ¤νΈ λ³€ν™)
    - μ™Έλ¶€ REST API νΈμ¶
    - ν΄λμ¤ κΈ°λ° λ΅μ§ μ‹¤ν–‰
    - LangChain Expression Language(LCEL) μ²΄μΈ ν†µν•© (ν…μ¤νΈ μ”μ•½ λ° κ°μ„± λ¶„μ„)
    - ν•μ„ κ·Έλν”„(Sub-graph) νΈμ¶
    - 2λ‹¨κ³„ μ‚¬μ©μ μΉμΈ/κ±°μ  (Human-in-the-Loop)
- **λ³µν•© μ‘μ—… νλ¦„ (Conditional Edges)**: λ‘ κ° μ΄μƒμ λ„κµ¬λ¥Ό μ΅°κ±΄μ— λ”°λΌ μμ°¨μ μΌλ΅ μ‹¤ν–‰ν•μ—¬ λ³µμ΅ν• μ‘μ—…μ„ μ²λ¦¬ν•©λ‹λ‹¤. (μ: API νΈμ¶ -> λ°μ΄ν„° λ¶„μ„)
- **FastAPI κΈ°λ° API μ„λ²„**: μ—μ΄μ „νΈμ™€ μƒνΈμ‘μ©ν•  μ μλ” λΉ„λ™κΈ° API μ—”λ“ν¬μΈνΈλ¥Ό μ κ³µν•©λ‹λ‹¤.
- **μΈν„°λ™ν‹°λΈ ν΄λΌμ΄μ–ΈνΈ**: ν„°λ―Έλ„μ—μ„ μ—μ΄μ „νΈμ™€ μ‹¤μ‹κ°„μΌλ΅ λ€ν™”ν•  μ μλ” ν΄λΌμ΄μ–ΈνΈλ¥Ό μ κ³µν•©λ‹λ‹¤.

## π”§ μ•„ν‚¤ν…μ²: λ„κµ¬ λ μ§€μ¤νΈλ¦¬ ν¨ν„΄

μ΄ ν”„λ΅μ νΈμ ν•µμ‹¬μ€ **λ„κµ¬ λ μ§€μ¤νΈλ¦¬(Tool Registry)** ν¨ν„΄μ„ μ‚¬μ©ν•μ—¬ `main.py`μ μμ • μ—†μ΄ μƒλ΅μ΄ κΈ°λ¥μ„ μ‰½κ² μ¶”κ°€ν•  μ μλ‹¤λ” μ μ…λ‹λ‹¤.

1.  **λ™μ  λ΅λ”©**: `tools/registry.py`μ `load_all_tools()` ν•¨μλ” `tools` λ””λ ‰ν„°λ¦¬ λ‚΄μ λ¨λ“  νμ΄μ¬ νμΌμ„ μ¤μΊ”ν•©λ‹λ‹¤.
2.  **κ·μΉ™ κΈ°λ° λ“±λ΅**: κ° νμΌμ—μ„ λ‹¤μ κ·μΉ™μ— λ§λ” λ³€μμ™€ ν•¨μλ¥Ό μ°Ύμ•„ λ™μ μΌλ΅ λ΅λ“ν•©λ‹λ‹¤.
    - **λ…Έλ“ ν•¨μ**: μ΄λ¦„μ΄ `_node`λ΅ λλ‚λ” ν•¨μ (μ: `api_call_node`)
    - **λ„κµ¬ μ„¤λ…**: μ΄λ¦„μ΄ `_description` λλ” `_descriptions`λ΅ λλ‚λ” λ³€μ
    - **κ·Έλν”„ μ—£μ§€**: μ΄λ¦„μ΄ `_edges`λ΅ λλ‚λ” λ³€μ (νΉλ³„ν• νλ¦„μ΄ ν•„μ”ν•  κ²½μ°)
3.  **κ·Έλν”„ μλ™ κµ¬μ„±**: `main.py`λ” λ μ§€μ¤νΈλ¦¬κ°€ μμ§‘ν• λ…Έλ“, μ„¤λ…, μ—£μ§€ μ •λ³΄λ¥Ό μ‚¬μ©ν•μ—¬ LangGraphλ¥Ό λ™μ μΌλ΅ κµ¬μ„±ν•©λ‹λ‹¤.

μ΄ κµ¬μ΅° λ•λ¶„μ— `main.py`λ” μ–΄λ–¤ λ„κµ¬κ°€ μ΅΄μ¬ν•λ”μ§€ μ• ν•„μ”κ°€ μ—†μΌλ©°, μ¤μ§ "μ΅°λ¦½κΈ°"μ μ—­ν• λ§ μν–‰ν•©λ‹λ‹¤.

## π“‚ ν”„λ΅μ νΈ κµ¬μ΅°

```
CoE/
β”β”€β”€ main.py             # FastAPI μ•± λ° λ©”μΈ LangGraph μ΅°λ¦½κΈ°
β”β”€β”€ client.py           # μ„λ²„μ™€ ν†µμ‹ ν•λ” ν„°λ―Έλ„ ν΄λΌμ΄μ–ΈνΈ
β”β”€β”€ llm_client.py       # LLM ν΄λΌμ΄μ–ΈνΈ μ΄κΈ°ν™”
β”β”€β”€ schemas.py          # Pydantic μ¤ν‚¤λ§ (λ°μ΄ν„° λ¨λΈ)
β”β”€β”€ .env                # ν™κ²½ λ³€μ νμΌ (API ν‚¤ λ“±)
β”β”€β”€ requirements.txt    # ν”„λ΅μ νΈ μμ΅΄μ„±
β”β”€β”€ tools/              # μ—μ΄μ „νΈκ°€ μ‚¬μ©ν•λ” λ„κµ¬ λ¨λ“
β”‚   β”β”€β”€ __init__.py
β”‚   β”β”€β”€ registry.py     # λ„κµ¬λ¥Ό λ™μ μΌλ΅ λ΅λ“ν•λ” λ μ§€μ¤νΈλ¦¬
β”‚   β”β”€β”€ utils.py        # λ„κµ¬ λ¨λ“μ—μ„ μ‚¬μ©ν•λ” μ ν‹Έλ¦¬ν‹° ν•¨μ
β”‚   β”β”€β”€ api_tool.py
β”‚   β”β”€β”€ basic_tools.py
β”‚   β”β”€β”€ class_tool.py
β”‚   β”β”€β”€ human_tool.py
β”‚   β”β”€β”€ langchain_tool.py
β”‚   β””β”€β”€ subgraph_tool.py
β””β”€β”€ README.md
```

## π€ μ‹μ‘ν•κΈ°

### 1. ν™κ²½ μ„¤μ •

```bash
# 1. μ €μ¥μ† λ³µμ 
git clone <repository-url>
cd CoE

# 2. κ°€μƒ ν™κ²½ μƒμ„± λ° ν™μ„±ν™”
python -m venv .venv
source .venv/bin/activate

# 3. μμ΅΄μ„± μ„¤μΉ
pip install -r requirements.txt

# 4. .env νμΌ μƒμ„± λ° API ν‚¤ μ„¤μ •
echo "OPENAI_API_KEY='your-openai-api-key'" > .env
```

### 2. μ„λ²„ λ° ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰

λ‘ κ°μ ν„°λ―Έλ„μ„ μ—΄κ³  κ°κ° λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤.

**ν„°λ―Έλ„ 1: FastAPI μ„λ²„ μ‹¤ν–‰**
```bash
python main.py
```

**ν„°λ―Έλ„ 2: μΈν„°λ™ν‹°λΈ ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰**
```bash
python client.py
```

## π’¬ μ‚¬μ© μμ‹

- **κΈ°λ³Έ λ„κµ¬ (λ€λ¬Έμ λ³€ν™)**
  > **You:** hello worldλ¥Ό λ€λ¬Έμλ΅ λ°”κΏ”μ¤
  > **Agent:** HELLO WORLD

- **API νΈμ¶**
  > **You:** 1λ² μ‚¬μ©μ μ •λ³΄ μ•λ ¤μ¤
  > **Agent:** API κ²°κ³Ό: sunt aut facere repellat provident occaecati excepturi optio reprehenderit

- **λ³µν•© μ‘μ—… (API νΈμ¶ + λ¶„μ„)**
  > **You:** 1λ² μ‚¬μ©μ λ°μ΄ν„° λ¶„μ„ν•΄μ¤
  > **Agent:** ν…μ¤νΈ λ¶„μ„ κ²°κ³Ό: κΈΈμ΄=294, λ‹¨μ–΄ μ=52

- **LangChain μ²΄μΈ (μ”μ•½ + κ°μ„± λ¶„μ„)**
  > **You:** μ΄ μν™” μ •λ§ μµκ³ μ€μ–΄! μ¤ν† λ¦¬λ„ κ°λ™μ μ΄κ³  μμƒλ―Έλ„ λ›°μ–΄λ‚¬μ–΄.
  > **Agent:** ν…μ¤νΈ λ¶„μ„ κ²°κ³Όμ…λ‹λ‹¤:
  > - μ”μ•½: μ΄ μν™”λ” μ¤ν† λ¦¬μ™€ μμƒλ―Έκ°€ λ›°μ–΄λ‚ λ§¤μ° ν›λ¥­ν–λ‹¤λ” ν‰κ°€μ…λ‹λ‹¤.
  > - κ°μ„±: Positive

- **Human-in-the-Loop (μ‚¬μ©μ μΉμΈ)**
  > **You:** μ¤‘μ”ν• μ‘μ—… μΉμΈν•΄μ¤
  > **Agent:** 'μ¤‘μ”ν• μ‘μ—… μΉμΈν•΄μ¤' μ‘μ—…μ— λ€ν• κ΄€λ¦¬μ μΉμΈμ΄ ν•„μ”ν•©λ‹λ‹¤. κ³„μ† μ§„ν–‰ν•λ ¤λ©΄ 'approve', μ·¨μ†ν•λ ¤λ©΄ 'reject'λ¥Ό μ…λ ¥ν•΄μ£Όμ„Έμ”.
  > **You:** approve
  > **Agent:** μΉμΈλμ—μµλ‹λ‹¤. μ”μ²­λ μ‘μ—…μ„ κ³„μ† μ§„ν–‰ν•©λ‹λ‹¤.

## π› οΈ μƒλ΅μ΄ λ„κµ¬ μ¶”κ°€ν•κΈ°

μ΄ μ•„ν‚¤ν…μ²μ κ°€μ¥ ν° μ¥μ μ€ μƒλ΅μ΄ λ„κµ¬λ¥Ό λ§¤μ° μ‰½κ² μ¶”κ°€ν•  μ μλ‹¤λ” κ²ƒμ…λ‹λ‹¤.

1.  `tools` λ””λ ‰ν„°λ¦¬μ— `my_new_tool.py`μ™€ κ°™μ€ μƒ νμ΄μ¬ νμΌμ„ λ§λ“­λ‹λ‹¤.
2.  νμΌ μ•μ— μ•„λμ™€ κ°™μ΄ **λ„κµ¬ μ„¤λ…**κ³Ό **λ…Έλ“ ν•¨μ**λ¥Ό κ·μΉ™μ— λ§κ² μ •μν•©λ‹λ‹¤.

**μμ‹: `tools/my_new_tool.py`**
```python
from typing import Dict, Any
from schemas import ChatState

# 1. λΌμ°ν„°κ°€ μ‚¬μ©ν•  λ„κµ¬ μ„¤λ… (λ³€μλ…μ€ _description λλ” _descriptionsλ΅ λλ‚μ•Ό ν•¨)
my_new_tool_description = {
    "name": "my_tool",
    "description": "μ΄κ²ƒμ€ μƒλ΅ μ¶”κ°€λ λ©‹μ§„ λ„κµ¬μ…λ‹λ‹¤."
}

# 2. μ‹¤μ  μ‘μ—…μ„ μν–‰ν•  λ…Έλ“ ν•¨μ (ν•¨μλ…μ€ _nodeλ΅ λλ‚μ•Ό ν•¨)
def my_tool_node(state: ChatState) -> Dict[str, Any]:
    # ... μ‹¤μ  λ„κµ¬ λ΅μ§ κµ¬ν„ ...
    return {"messages": [{"role": "assistant", "content": "μƒλ΅μ΄ λ„κµ¬ μ‹¤ν–‰ μ™„λ£!"}]}
```

3.  **λμ…λ‹λ‹¤!** `main.py`λ¥Ό μμ •ν•  ν•„μ” μ—†μ΄ μ„λ²„λ¥Ό μ¬μ‹μ‘ν•λ©΄ μ—μ΄μ „νΈκ°€ `my_tool`μ„ μλ™μΌλ΅ μΈμ‹ν•κ³  λΌμ°ν…μ— μ‚¬μ©ν•©λ‹λ‹¤.

### λ³µμ΅ν• νλ¦„ μ¶”κ°€ν•κΈ°

λ§μ•½ λ„κµ¬κ°€ μ‹¤ν–‰λ ν›„ νΉμ • λ‹¤λ¥Έ λ…Έλ“λ΅ μ—°κ²°λμ–΄μ•Ό ν•λ‹¤λ©΄, `_edges` λ³€μλ¥Ό μ •μν•μ—¬ κ·Έλν”„ νλ¦„μ„ μ§€μ •ν•  μ μμµλ‹λ‹¤. μμ„Έν• λ‚΄μ©μ€ `tools/api_tool.py`λ‚ `tools/human_tool.py`λ¥Ό μ°Έκ³ ν•μ„Έμ”.

## π“ API μ—”λ“ν¬μΈνΈ

- **`POST /chat`**: μ±„ν… λ©”μ‹μ§€λ¥Ό λ°›μ•„ μ—μ΄μ „νΈλ¥Ό μ‹¤ν–‰ν•κ³  μ‘λ‹µμ„ λ°ν™ν•©λ‹λ‹¤.
- **`GET /v1/models`**: LangChain νΈν™μ„±μ„ μ„ν• λ¨λΈ λ©λ΅μ„ λ°ν™ν•©λ‹λ‹¤.



## π’ ν•΄μ•Όν•  μΌ

### Todo

- [ ] CoE Backend
  - [ ] Embedding λ¨λΈ ν†µν• μΏΌλ¦¬ λ²΅ν„°
  - [ ] λ²΅ν„°db ν™μ©
  - [ ] Docker λ°°ν¬ μ¤ν¬λ¦½νΈ
- [ ] RAG μƒμ„± νμ΄ν”„ λΌμΈ
  - [ ] μ •μ  λ¶„μ„λ„κµ¬ λ¦¬μ„μΉ
  - [ ] ν”„λ΅μ„Έμ¤ νμ΄ν”„λΌμΈ μ •λ¦¬
- [ ] vsCode Extention
  - [ ] copilot open source λ¶„μ„
- [ ] CoE Portal
  - [ ] webIDE λ¦¬μ„μΉ

### ing
- [ ] CoE Backend
  - [X] μƒν” ν’μ§ κ³ λ„ν™”

### Done

- [X] LangGraph Backend μƒν”