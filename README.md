# π¤– CoE-Backend: AI μ—μ΄μ „νΈ λ° API μ„λ²„

**CoE for AI** ν”λ«νΌμ ν•µμ‹¬ λ°±μ—”λ“ μ„λ²„μ…λ‹λ‹¤. **LangGraph**μ™€ **FastAPI**λ¥Ό κΈ°λ°μΌλ΅ κµ¬μ¶•λ ν™•μ¥ κ°€λ¥ν• AI μ—μ΄μ „νΈ μ‹μ¤ν…μΌλ΅, λ‹¤μ–‘ν• AI μ›ν¬ν”λ΅μ°λ¥Ό μ§€μ›ν•©λ‹λ‹¤.

## π― ν•µμ‹¬ κ°€μΉ

- **π”§ ν™•μ¥μ„±**: λ„κµ¬ λ μ§€μ¤νΈλ¦¬ ν¨ν„΄μΌλ΅ μƒλ΅μ΄ κΈ°λ¥μ„ μ‰½κ² μ¶”κ°€
- **π”— νΈν™μ„±**: OpenWebUI, LangFlowμ™€ μ™„λ²½ νΈν™
- **π€ μ„±λ¥**: λΉ„λ™κΈ° FastAPI κΈ°λ° κ³ μ„±λ¥ API μ„λ²„
- **π›΅οΈ μ•μ •μ„±**: μ™„μ „ν• λ¨λ“ν™”μ™€ μ²΄κ³„μ μΈ μ—λ¬ μ²λ¦¬

## β¨ μ£Όμ” κΈ°λ¥

- **π¤– AI μ—μ΄μ „νΈ μ‹μ¤ν…**: λ™μ  λ„κµ¬ λΌμ°ν…, μλ™ λ„κµ¬ λ“±λ΅, λ©€ν‹°ν„΄ λ€ν™”
- **π”— ν”λ«νΌ νΈν™μ„±**: OpenWebUI, LangFlow μ—°λ™ λ° λ‹¤μ¤‘ LLM μ§€μ›
- **π” κ²€μƒ‰ λ° μ„λ² λ”©**: ChromaDB κΈ°λ° λ²΅ν„° κ²€μƒ‰ λ° ν•κµ­μ–΄ νΉν™” λ¨λΈ μ§€μ› (RAG)
- **π‘¨β€π’» μ½”λ”© μ–΄μ‹μ¤ν„΄νΈ**: 10κ° μ΄μƒ μ£Όμ” μ–Έμ–΄μ μ½”λ“ λ¶„μ„, μƒμ„±, λ¦¬λ·° μ§€μ›

## π”§ μ•„ν‚¤ν…μ²: λ„κµ¬ λ μ§€μ¤νΈλ¦¬ ν¨ν„΄

μ΄ ν”„λ΅μ νΈλ” `main.py` μμ • μ—†μ΄ μƒλ΅μ΄ κΈ°λ¥μ„ λ™μ μΌλ΅ μ¶”κ°€ν•  μ μλ” **λ„κµ¬ λ μ§€μ¤νΈλ¦¬(Tool Registry)** ν¨ν„΄μ„ μ‚¬μ©ν•©λ‹λ‹¤. `tools/registry.py`κ°€ `tools` λ””λ ‰ν„°λ¦¬ λ‚΄μ λ„κµ¬λ“¤μ„ μλ™μΌλ΅ μ¤μΊ”ν•κ³ , `main.py`λ” μ΄λ¥Ό μ΅°λ¦½ν•μ—¬ LangGraphλ¥Ό κµ¬μ„±ν•©λ‹λ‹¤.

## π“‚ ν”„λ΅μ νΈ κµ¬μ΅°

```
CoE-Backend/
β”β”€β”€ main.py                 # FastAPI μ•± λ° λ©”μΈ LangGraph μ΅°λ¦½κΈ°
β”β”€β”€ Dockerfile              # Docker μ΄λ―Έμ§€ λΉλ“ νμΌ
β”β”€β”€ .env.sample             # ν™κ²½ λ³€μ μμ‹ νμΌ
β”β”€β”€ requirements.txt        # ν”„λ΅μ νΈ μμ΅΄μ„±
β”β”€β”€ README.md               # ν”„λ΅μ νΈ λ¬Έμ„
β”β”€β”€ run.sh                  # μ‹¤ν–‰ μ¤ν¬λ¦½νΈ
β”β”€β”€ api/                    # API μ—”λ“ν¬μΈνΈ λ¨λ“
β”‚   β”β”€β”€ chat_api.py
β”‚   β”β”€β”€ embeddings_api.py
β”‚   β”β”€β”€ flows_api.py
β”‚   β”β”€β”€ health_api.py
β”‚   β”β”€β”€ models_api.py
β”‚   β”β”€β”€ coding_assistant/
β”‚   β”‚   β””β”€β”€ code_api.py
β”‚   β”β”€β”€ tools/
β”‚   β”‚   β””β”€β”€ dynamic_tools_api.py
β”‚   β””β”€β”€ vector/
β”‚       β””β”€β”€ vector_api.py
β”β”€β”€ config/                 # μ„¤μ • νμΌ
β”‚   β””β”€β”€ models.json
β”β”€β”€ core/                   # ν•µμ‹¬ λΉ„μ¦λ‹μ¤ λ΅μ§
β”‚   β””β”€β”€ ...
β”β”€β”€ docs/                   # λ¬Έμ„ ν΄λ”
β”β”€β”€ flows/                  # LangFlow μ›ν¬ν”λ΅μ° μ €μ¥μ†
β”β”€β”€ routers/                # λΌμ°ν„° λ¨λ“
β”β”€β”€ services/               # λΉ„μ¦λ‹μ¤ μ„λΉ„μ¤ λ μ΄μ–΄
β”‚   β””β”€β”€ ...
β”β”€β”€ tools/                  # μ—μ΄μ „νΈ λ„κµ¬ λ¨λ“
β”‚   β”β”€β”€ README.md
β”‚   β”β”€β”€ registry.py
β”‚   β””β”€β”€ ...
β””β”€β”€ utils/                  # μ ν‹Έλ¦¬ν‹° ν•¨μ
    β””β”€β”€ ...
```

## π€ λΉ λ¥Έ μ‹μ‘

### π“‹ μ‚¬μ „ μ”κµ¬μ‚¬ν•­
- Python 3.8+ λλ” Docker
- LLM API ν‚¤ (SKAX, OpenAI λ“±)

### π”§ ν™κ²½ λ³€μ μ„¤μ •
1.  `.env.sample` νμΌμ„ λ³µμ‚¬ν•μ—¬ `.env` νμΌμ„ μƒμ„±ν•©λ‹λ‹¤.
    ```bash
    cp .env.sample .env
    ```
2.  `.env` νμΌμ„ μ—΄μ–΄ `SKAX_API_KEY`, `OPENAI_API_KEY` λ“± ν•„μ”ν• API ν‚¤λ¥Ό μ„¤μ •ν•©λ‹λ‹¤.
    - λ΅μ»¬ κ°λ° μ‹μ—λ” `.env.local` νμΌμ„ μ‚¬μ©ν•λ©΄ `run.sh` μ¤ν¬λ¦½νΈκ°€ μλ™μΌλ΅ λ΅λ“ν•©λ‹λ‹¤.
    - Dockerμ™€ λ΅μ»¬ ν™κ²½μ λ°μ΄ν„°λ² μ΄μ¤, ChromaDB λ“±μ μ ‘μ† μ •λ³΄λ” `.env.sample`μ— μμ„Έν μ•λ‚΄λμ–΄ μμµλ‹λ‹¤.

### π³ Dockerλ΅ μ‹¤ν–‰ (κ¶μ¥)
```bash
# 1. Docker μ΄λ―Έμ§€ λΉλ“
docker build -t coe-backend .

# 2. μ»¨ν…μ΄λ„ μ‹¤ν–‰
docker run -d -p 8000:8000 --name coe-backend --env-file .env coe-backend

# 3. μ„λΉ„μ¤ ν™•μΈ
curl http://localhost:8000/health
```

### π λ΅μ»¬ κ°λ° ν™κ²½
`run.sh` μ¤ν¬λ¦½νΈλ¥Ό μ‚¬μ©ν•λ©΄ κ°€μƒ ν™κ²½ μ„¤μ •, μμ΅΄μ„± μ„¤μΉ, μ„λ²„ μ‹¤ν–‰μ„ ν• λ²μ— μ²λ¦¬ν•  μ μμµλ‹λ‹¤.
```bash
# μ¤ν¬λ¦½νΈ μ‹¤ν–‰ κ¶ν• λ¶€μ—¬
chmod +x run.sh

# μ„λ²„ μ‹¤ν–‰
./run.sh
```

## π” ν”λ«νΌ μ—°λ™

### π OpenWebUI μ—°λ™
1.  OpenWebUI **μ„¤μ •** β†’ **μ—°κ²°** λ©”λ‰΄λ΅ μ΄λ™
2.  **API Base URL**: `http://localhost:8000/v1` μ…λ ¥ (Docker ν™κ²½μ—μ„λ” `http://coe-backend:8000/v1`)
3.  **API Key**: λΉ„μ›λ‘κ³  μ €μ¥
4.  λ¨λΈ μ„ νƒμ—μ„ **CoE Agent v1** μ„ νƒ

### π”„ LangFlow μ—°λ™
`/flows/save`, `/flows/list` λ“±μ APIλ¥Ό ν†µν•΄ LangFlow μ›ν¬ν”λ΅μ°λ¥Ό μ €μ¥ν•κ³  κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤.

## π’¬ API μ‚¬μ© μμ‹

`curl`μ„ μ‚¬μ©ν•μ—¬ λ‹¤μ–‘ν• μ—”λ“ν¬μΈνΈλ¥Ό ν…μ¤νΈν•  μ μμµλ‹λ‹¤.

- **AI μ—μ΄μ „νΈ μ±„ν…**: `POST /v1/chat/completions`
- **μ½”λ”© μ–΄μ‹μ¤ν„΄νΈ**: `POST /api/coding-assistant/analyze`
- **λ²΅ν„° κ²€μƒ‰**: `POST /vector/search`
- **μ‹μ¤ν… μƒνƒ**: `GET /health`

μμ„Έν• λ‚΄μ©μ€ [API λ νΌλ°μ¤](#-api-λ νΌλ°μ¤) μ„Ήμ…μ„ μ°Έμ΅°ν•μ„Έμ”.

## π› οΈ κ°λ°μ κ°€μ΄λ“: μƒλ΅μ΄ λ„κµ¬ μ¶”κ°€ν•κΈ°

`main.py`λ¥Ό μμ •ν•μ§€ μ•κ³  `tools` λ””λ ‰ν„°λ¦¬μ— νμΌμ„ μ¶”κ°€ν•λ” κ²ƒλ§μΌλ΅ μƒλ΅μ΄ κΈ°λ¥μ„ ν™•μ¥ν•  μ μμµλ‹λ‹¤.

**1λ‹¨κ³„: λ„κµ¬ νμΌ μƒμ„±**
```python
# tools/my_custom_tool.py
from typing import Dict, Any
from core.schemas import ChatState

# λ„κµ¬ μ„¤λ… (λ³€μλ…μ€ _descriptionμΌλ΅ λλ‚μ•Ό ν•¨)
my_custom_tool_description = {
    "name": "my_custom_tool",
    "description": "μ‚¬μ©μ μ •μ λ„κµ¬μ…λ‹λ‹¤."
}

# λ…Έλ“ ν•¨μ (ν•¨μλ…μ€ _nodeλ΅ λλ‚μ•Ό ν•¨)
def my_custom_tool_node(state: ChatState) -> Dict[str, Any]:
    # λ„κµ¬ λ΅μ§ κµ¬ν„
    result = "λ„κµ¬ μ‹¤ν–‰ κ²°κ³Ό"
    return {"messages": [{"role": "assistant", "content": result}]}
```

**2λ‹¨κ³„: μ„λ²„ μ¬μ‹μ‘**
κ°λ° μ„λ²„λ” λ³€κ²½μ‚¬ν•­μ„ κ°μ§€ν•κ³  μλ™μΌλ΅ μ¬μ‹μ‘λ©λ‹λ‹¤.

## π“ API λ νΌλ°μ¤

### π¤– AI μ—μ΄μ „νΈ & μ±„ν…
| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μ„¤λ… |
|-----------|--------|------|
| `/v1/chat/completions` | POST | OpenAI νΈν™ μ±„ν… API (ν•µμ‹¬) |
| `/v1/models` | GET | μ‚¬μ© κ°€λ¥ν• λ¨λΈ λ©λ΅ |

### π” λ²΅ν„° κ²€μƒ‰ & μ„λ² λ”©
| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μ„¤λ… |
|-----------|--------|------|
| `/v1/embeddings` | POST | OpenAI νΈν™ μ„λ² λ”© API |
| `/vector/search` | POST | λ²΅ν„° μ μ‚¬λ„ κ²€μƒ‰ |
| `/vector/add` | POST | λ¬Έμ„ μ¶”κ°€ λ° μ„λ² λ”© |
| `/vector/info` | GET | λ²΅ν„° DB μƒνƒ μ •λ³΄ |

### π‘¨β€π’» μ½”λ”© μ–΄μ‹μ¤ν„΄νΈ
| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μ„¤λ… |
|-----------|--------|------|
| `/api/coding-assistant/languages` | GET | μ§€μ› μ–Έμ–΄ λ©λ΅ |
| `/api/coding-assistant/analyze` | POST | μ½”λ“ λ¶„μ„ & λ©”νΈλ¦­ |
| `/api/coding-assistant/generate` | POST | AI μ½”λ“ μƒμ„± |

### π”„ μ›ν¬ν”λ΅μ° κ΄€λ¦¬
| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μ„¤λ… |
|-----------|--------|------|
| `/flows/save` | POST | LangFlow μ›ν¬ν”λ΅μ° μ €μ¥ |
| `/flows/list` | GET | μ €μ¥λ μ›ν¬ν”λ΅μ° λ©λ΅ |

### π¥ μ‹μ¤ν… μƒνƒ
| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μ„¤λ… |
|-----------|--------|------|
| `/health` | GET | μ„λΉ„μ¤ μƒνƒ ν™•μΈ |

## π”§ λ¬Έμ  ν•΄κ²°
- **API ν‚¤ μ¤λ¥**: `.env` νμΌμ— API ν‚¤κ°€ μ¬λ°”λ¥΄κ² μ„¤μ •λμ—λ”μ§€ ν™•μΈν•μ„Έμ”.
- **ν¬νΈ μ¶©λ**: `lsof -i :8000` (macOS/Linux) λ…λ Ήμ–΄λ΅ 8000λ² ν¬νΈλ¥Ό μ‚¬μ©ν•λ” ν”„λ΅μ„Έμ¤κ°€ μλ”μ§€ ν™•μΈν•μ„Έμ”.
